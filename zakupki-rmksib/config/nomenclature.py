"""Справочник номенклатурных групп"""
from typing import Dict, List

# Специальная позиция "Все лоты" - означает парсинг всех лотов без фильтрации по номенклатуре
ALL_LOTS_KEY = "Все лоты"

# Справочник номенклатурных групп с ключевыми словами для фильтрации
NOMENCLATURE_CATALOG: Dict[str, List[str]] = {
    "Строительные материалы": [
        "цемент", "бетон", "кирпич", "песок", "щебень", "гравий", "асфальт",
        "гипс", "известь", "штукатурка", "краска", "лак", "грунтовка"
    ],
    "Строительное оборудование": [
        "бетономешалка", "крановое", "леса", "строительное оборудование",
        "компрессор", "сварочное", "инструмент строительный"
    ],
    "Геосинтетические и геополимерные материалы и изделия": [
        "геосинтетика", "геотекстиль", "геомембрана", "геополимер",
        "георешетка", "геосетка"
    ],
    "Изделия для технологических трубопроводов": [
        "труба", "трубопровод", "арматура трубопроводная", "фланец",
        "задвижка", "кран", "клапан", "отвод", "тройник"
    ],
    "Электротехнические материалы и изделия": [
        "кабель", "провод", "электротехнический", "изоляция",
        "розетка", "выключатель", "автомат", "щит", "светильник"
    ],
    "Запасные части для спецтехники": [
        "запчасть", "деталь", "комплектующая", "фильтр", "масло",
        "гидравлика", "гидроцилиндр", "насос", "двигатель"
    ],
    "Промышленное оборудование": [
        "оборудование промышленное", "станок", "пресс", "насосное",
        "вентиляционное", "котельное", "насос"
    ],
    "Геодезическое и геологоразведочное оборудование": [
        "геодезия", "геологоразведка", "теодолит", "нивелир",
        "gps", "gnss", "тахеометр"
    ],
    "Контрольно-измерительные приборы": [
        "кип", "прибор", "датчик", "измерительный", "контрольный",
        "манометр", "термометр", "расходомер"
    ],
    "Спецхимия": [
        "химия", "реагент", "реактив", "кислота", "щелочь",
        "растворитель", "смазка", "антифриз"
    ],
    "Инструменты": [
        "инструмент", "ключ", "отвертка", "молоток", "дрель",
        "болгарка", "перфоратор", "пила"
    ],
    "Резинотехнические изделия": [
        "рти", "резина", "уплотнитель", "прокладка", "манжета",
        "шланг", "рукав", "лента конвейерная"
    ],
    "Метизы и крепёжные изделия": [
        "болт", "гайка", "винт", "шпилька", "шайба", "метиз",
        "крепеж", "анкер", "дюбель", "саморез", "гвоздь"
    ],
    "Мебель и системы хранения": [
        "мебель", "шкаф", "стол", "стул", "стеллаж", "полка",
        "система хранения", "ящик"
    ],
    "Спецодежда, СИЗ, товары для ОТ и ТБ": [
        "спецодежда", "сиз", "каска", "перчатка", "очки",
        "респиратор", "обувь рабочая", "костюм"
    ],
    "Компьютерная техника и периферия": [
        "компьютер", "ноутбук", "монитор", "принтер", "сканер",
        "клавиатура", "мышь", "сервер", "сетевое оборудование"
    ],
    "Бытовая техника": [
        "бытовая техника", "холодильник", "стиральная машина",
        "микроволновка", "чайник", "утюг"
    ],
    "Хозяйственные товары": [
        "хозяйственный", "моющее средство", "тряпка", "ведро",
        "швабра", "инвентарь хозяйственный"
    ],
    "Тара": [
        "тара", "контейнер", "ящик", "бочка", "канистра",
        "бидон", "мешок", "пакет"
    ],
    "Прочие ТМЦ": [
        "прочее", "тмц", "материал", "изделие"
    ],
    "Лабораторное оборудование": [
        "лабораторное", "весы", "аналитический", "микроскоп",
        "термостат", "сушильный шкаф"
    ]
}

# Список всех номенклатурных групп (с "Все лоты" в начале)
NOMENCLATURE_LIST = [ALL_LOTS_KEY] + list(NOMENCLATURE_CATALOG.keys())


def get_nomenclature_keywords(nomenclature_name: str) -> List[str]:
    """Получить ключевые слова для номенклатурной группы"""
    # Для "Все лоты" возвращаем пустой список (фильтрация не применяется)
    if nomenclature_name == ALL_LOTS_KEY:
        return []
    return NOMENCLATURE_CATALOG.get(nomenclature_name, [])


def check_nomenclature_match(lot_name: str, nomenclature_list: List[str]) -> bool:
    """
    Проверяет, соответствует ли название лота выбранным номенклатурным группам
    
    Args:
        lot_name: Название лота
        nomenclature_list: Список выбранных номенклатурных групп
    
    Returns:
        True если лот соответствует хотя бы одной номенклатурной группе
        Если в списке есть "Все лоты", всегда возвращает True
    """
    if not nomenclature_list:
        return True  # Если номенклатура не выбрана, пропускаем все
    
    # Если выбрана позиция "Все лоты", пропускаем все лоты без фильтрации
    if ALL_LOTS_KEY in nomenclature_list:
        return True
    
    lot_name_lower = lot_name.lower()
    
    for nomenclature in nomenclature_list:
        keywords = get_nomenclature_keywords(nomenclature)
        # Если список ключевых слов пустой (например, для "Все лоты"), пропускаем
        if not keywords:
            continue
        if any(keyword in lot_name_lower for keyword in keywords):
            return True
    
    return False



