# Требования к ресурсам для работы приложения

> **Примечание:** Детальный анализ размера проекта см. в `PROJECT_SIZE_ANALYSIS.md`

## Параметры нагрузки

- **20 заявок в день** (лоты)
- **200 коммерческих предложений** (КП)
- **~1000 товарных позиций** (номенклатура)

---

## Анализ использования ресурсов

### 1. База данных (PostgreSQL)

#### Объем данных

**Лоты (20/день):**
- За месяц: 20 × 30 = 600 лотов
- За год: 20 × 365 = 7,300 лотов
- Размер записи: ~2-5 КБ (с документацией)
- Годовой объем: ~15-35 МБ

**Коммерческие предложения (200 КП):**
- За месяц: 200 КП
- За год: 200 × 12 = 2,400 КП
- Размер записи: ~5-10 КБ (с текстом и файлами)
- Годовой объем: ~12-24 МБ

**Товарные позиции (1000 позиций):**
- Хранятся в JSON поле `nomenclature` в лотах
- Средний размер: ~1-2 КБ на позицию
- Общий объем: ~1-2 МБ

**Пользователи:**
- Ожидаемое количество: 10-50 пользователей
- Размер записи: ~0.5 КБ
- Общий объем: ~5-25 КБ

**Поставщики:**
- Ожидаемое количество: 100-500 поставщиков
- Размер записи: ~1 КБ
- Общий объем: ~100-500 КБ

**Итого БД:**
- Минимум: ~30-40 МБ в год
- С запасом (3 года): ~100-150 МБ
- С индексами и служебными данными: ~200-300 МБ

#### Требования к БД:
- **Минимум:** 1 ГБ дискового пространства
- **Рекомендуется:** 5 ГБ (с запасом на 3+ года)
- **RAM:** 256 МБ - 512 МБ для PostgreSQL
- **CPU:** 1 ядро достаточно

---

### 2. Хранилище файлов

**Документация лотов:**
- 20 лотов/день × 1-2 МБ (PDF) = 20-40 МБ/день
- За месяц: ~600 МБ - 1.2 ГБ
- За год: ~7-15 ГБ

**Файлы коммерческих предложений:**
- 200 КП × 0.5-2 МБ = 100-400 МБ
- За год: ~1.2-5 ГБ

**Итого хранилище:**
- За месяц: ~1-2 ГБ
- За год: ~8-20 ГБ
- **Рекомендуется:** 50-100 ГБ (с запасом)

---

### 3. Redis (кэширование и сессии)

**Сессии пользователей:**
- 10-50 активных пользователей
- Размер сессии: ~1-2 КБ
- Общий объем: ~10-100 КБ

**Кэш данных:**
- Кэш лотов: ~1-5 МБ
- Кэш статистики: ~0.1 МБ

**Итого Redis:**
- **Минимум:** 64 МБ
- **Рекомендуется:** 256 МБ - 512 МБ

---

### 4. Вычислительные ресурсы (CPU/RAM)

#### Обработка лотов (20/день):
- Парсинг: ~1-2 секунды на лот
- Анализ через LLM: ~5-10 секунд на лот (если используется)
- **Пиковая нагрузка:** 20 лотов × 10 сек = 200 сек (~3.5 минуты)

#### Обработка КП (200 КП):
- Извлечение текста: ~1-3 секунды на файл
- Распознавание данных: ~0.5-1 секунда
- Анализ через LLM: ~5-10 секунд на КП
- **Пиковая нагрузка:** 200 КП × 10 сек = 2000 сек (~33 минуты)

#### LLM запросы (Perplexity API):
- Запрос на анализ лота: ~5-10 секунд
- Запрос на анализ КП: ~5-10 секунд
- Запрос на извлечение суммы прописью: ~3-5 секунд
- **Ограничения API:** зависит от тарифа Perplexity

#### Требования к серверу:
- **CPU:** 2 ядра (для параллельной обработки)
- **RAM:** 
  - Минимум: 1 ГБ
  - Рекомендуется: 2-4 ГБ
  - Для обработки файлов и LLM: 4-8 ГБ

---

### 5. Сетевые ресурсы

#### Входящий трафик:
- Загрузка файлов КП: 200 × 1 МБ = 200 МБ
- Загрузка документации лотов: 20 × 1 МБ = 20 МБ
- **Итого:** ~220 МБ/день

#### Исходящий трафик:
- Отправка email уведомлений: ~1-5 МБ/день
- Запросы к Perplexity API: ~10-50 МБ/день
- **Итого:** ~11-55 МБ/день

#### Общий трафик:
- **В день:** ~230-275 МБ
- **В месяц:** ~7-8 ГБ
- **В год:** ~85-100 ГБ

---

### 6. Внешние API

#### Perplexity API:
- Анализ лота: ~1 запрос на лот (20/день)
- Анализ КП: ~1-2 запроса на КП (200/день)
- Извлечение суммы прописью (fallback): ~10-20% от КП (20-40/день)
- **Итого:** ~240-260 запросов/день
- **В месяц:** ~7,200-7,800 запросов
- **Стоимость:** зависит от тарифа Perplexity

---

## Рекомендуемая конфигурация сервера

### Минимальная конфигурация:
- **CPU:** 2 ядра
- **RAM:** 2 ГБ
- **Диск:** 20 ГБ SSD
- **Сеть:** 100 Мбит/с

### Рекомендуемая конфигурация:
- **CPU:** 4 ядра
- **RAM:** 4-8 ГБ
- **Диск:** 100 ГБ SSD
- **Сеть:** 1 Гбит/с

### Для масштабирования:
- **CPU:** 4-8 ядер
- **RAM:** 8-16 ГБ
- **Диск:** 200+ ГБ SSD
- **Сеть:** 1 Гбит/с

---

## Docker контейнеры

### Текущая конфигурация:
- **bot** (Python приложение): ~200-500 МБ RAM
- **postgres** (БД): ~256-512 МБ RAM
- **redis** (кэш): ~64-256 МБ RAM

### Итого:
- **Минимум:** ~500 МБ - 1 ГБ RAM
- **Рекомендуется:** 2-4 ГБ RAM

---

## Оптимизация

### Для снижения нагрузки:

1. **Кэширование:**
   - Кэшировать результаты анализа LLM
   - Кэшировать статистику (обновлять раз в час)

2. **Асинхронная обработка:**
   - Обработка КП в фоне
   - Очередь задач для LLM запросов

3. **Очистка данных:**
   - Архивировать старые лоты (>1 года)
   - Удалять неиспользуемые файлы КП

4. **Оптимизация БД:**
   - Индексы на часто используемые поля
   - Партиционирование таблиц по датам

---

## Мониторинг

### Метрики для отслеживания:

1. **БД:**
   - Размер БД
   - Количество записей в таблицах
   - Время выполнения запросов

2. **Файловое хранилище:**
   - Использованное пространство
   - Количество файлов

3. **Производительность:**
   - Время обработки КП
   - Время ответа LLM API
   - Загрузка CPU/RAM

4. **API:**
   - Количество запросов к Perplexity
   - Ошибки API
   - Лимиты API

---

## Резервное копирование

### Рекомендации:

1. **БД:** Ежедневное резервное копирование
2. **Файлы:** Еженедельное резервное копирование
3. **Конфигурация:** Версионирование в Git

### Размер бэкапов:
- БД: ~100-300 МБ
- Файлы: ~1-2 ГБ
- **Итого:** ~1-2.5 ГБ на бэкап

---

## Итоговые требования

### Для работы с указанной нагрузкой:

| Ресурс | Минимум | Рекомендуется |
|--------|---------|---------------|
| **CPU** | 2 ядра | 4 ядра |
| **RAM** | 2 ГБ | 4-8 ГБ |
| **Диск** | 20 ГБ | 100 ГБ |
| **Сеть** | 100 Мбит/с | 1 Гбит/с |
| **PostgreSQL** | 1 ГБ | 5 ГБ |
| **Redis** | 64 МБ | 256 МБ |
| **Файлы** | 20 ГБ | 50-100 ГБ |

### Облачные решения:

**VPS (минимальная):**
- DigitalOcean: 2 CPU, 2 GB RAM, 40 GB SSD - ~$12/мес
- Hetzner: 2 CPU, 4 GB RAM, 40 GB SSD - ~$8/мес

**VPS (рекомендуемая):**
- DigitalOcean: 4 CPU, 8 GB RAM, 160 GB SSD - ~$48/мес
- Hetzner: 4 CPU, 8 GB RAM, 160 GB SSD - ~$20/мес

---

**Дата создания:** 19 ноября 2025  
**Версия:** 1.0

